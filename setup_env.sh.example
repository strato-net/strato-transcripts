#!/bin/bash
# ==============================================================================
# Environment Variables for WhisperX Transcription + AI Post-Processing
# ==============================================================================
# Copy this file to setup_env.sh and fill in your API keys.
# Only HF_TOKEN is required for transcription.
# OPENROUTER_API_KEY provides access to all 11 AI post-processing models.

# ==============================================================================
# REQUIRED: HuggingFace Token (for WhisperX diarization models)
# ==============================================================================
# Get your token from: https://huggingface.co/settings/tokens
# Accept model agreements at:
#   - https://huggingface.co/pyannote/speaker-diarization-3.1
#   - https://huggingface.co/pyannote/segmentation-3.0
export HF_TOKEN=""

# ==============================================================================
# AI POST-PROCESSING: OpenRouter API Key (single key for all 11 models)
# ==============================================================================
# OpenRouter provides unified access to all major AI models with one API key.
# Get your key from: https://openrouter.ai/keys
#
# SUPPORTED MODELS (via OpenRouter):
#   opus     - Claude Opus 4.5 (Anthropic)     - 200K context
#   gemini   - Gemini 3 Pro (Google)           - 1M context
#   deepseek - DeepSeek V3.2                   - 128K context
#   chatgpt  - GPT-5.2 (OpenAI)                - 400K context
#   qwen     - Qwen3-Max (Alibaba)             - 256K context
#   kimi     - Kimi K2 (Moonshot)              - 256K context
#   glm      - GLM-4.7 (Z.ai)                  - 203K context
#   minimax  - MiniMax M2.1                    - 4M context
#   llama    - Llama 4 Maverick (Meta)         - 1M context
#   grok     - Grok 4 (xAI)                    - 256K context
#   mistral  - Mistral Large (Mistral AI)      - 256K context
#
# All models have sufficient context for typical transcripts (20K-45K tokens).
# OpenRouter charges ~5% markup over direct API pricing.
export OPENROUTER_API_KEY=""

# ==============================================================================
# OPTIONAL: Transcription Service API Keys
# ==============================================================================

# AssemblyAI (Cloud transcription with speaker diarization)
# Get key from: https://www.assemblyai.com/
export ASSEMBLYAI_API_KEY=""

# Replicate (Cloud WhisperX transcription)
# Get key from: https://replicate.com/account/api-tokens
export REPLICATE_API_TOKEN=""

# ==============================================================================
# PyTorch CUDA Library Path (for GPU operations)
# ==============================================================================
# Set LD_LIBRARY_PATH for CUDA libraries in this project's venv
# Only active when setup_env.sh is sourced (project-specific, not global)
PROJECT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_DIR="$PROJECT_DIR/venv"

if [ -d "$VENV_DIR/lib/python3.12/site-packages/nvidia" ]; then
    export LD_LIBRARY_PATH="$VENV_DIR/lib/python3.12/site-packages/nvidia/cudnn/lib:$VENV_DIR/lib/python3.12/site-packages/nvidia/cublas/lib:$VENV_DIR/lib/python3.12/site-packages/nvidia/cu13/lib:$LD_LIBRARY_PATH"
fi

# ==============================================================================
# Display Configuration
# ==============================================================================
echo "Environment variables set"

if [ -n "$HF_TOKEN" ] && [ "$HF_TOKEN" != "" ]; then
  echo "  HF_TOKEN: SET"
else
  echo "  HF_TOKEN: NOT SET (required for WhisperX diarization)"
fi

if [ -n "$OPENROUTER_API_KEY" ] && [ "$OPENROUTER_API_KEY" != "" ]; then
  echo "  OPENROUTER_API_KEY: SET (access to all 11 AI models)"
else
  echo "  OPENROUTER_API_KEY: NOT SET"
fi

if [ -n "$ASSEMBLYAI_API_KEY" ] && [ "$ASSEMBLYAI_API_KEY" != "" ]; then
  echo "  ASSEMBLYAI_API_KEY: SET"
else
  echo "  ASSEMBLYAI_API_KEY: NOT SET"
fi

if [ -n "$REPLICATE_API_TOKEN" ] && [ "$REPLICATE_API_TOKEN" != "" ]; then
  echo "  REPLICATE_API_TOKEN: SET"
else
  echo "  REPLICATE_API_TOKEN: NOT SET"
fi

echo ""
echo "See README.md for usage examples and documentation."
